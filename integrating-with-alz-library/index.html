
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://azure.github.io/enterprise-azure-policy-as-code/integrating-with-alz-library/">
      
      
        <link rel="prev" href="../integrating-with-alz-overview/">
      
      
        <link rel="next" href="../integrating-with-alz/">
      
      
      <link rel="icon" href="../Images/10316-icon-service-Policy.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>ALZ Policy Integration (New) - Enterprise Policy As Code (EPAC)</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#integrating-epac-with-the-azure-landing-zones-library-new" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Enterprise Policy As Code (EPAC)" class="md-header__button md-logo" aria-label="Enterprise Policy As Code (EPAC)" data-md-component="logo">
      
  <img src="../Images/10316-icon-service-Policy.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Enterprise Policy As Code (EPAC)
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ALZ Policy Integration (New)
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Azure/enterprise-azure-policy-as-code" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../start-implementing/" class="md-tabs__link">
          
  
  
    
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../settings-global-setting-file/" class="md-tabs__link">
          
  
  
    
  
  Settings and Desired State

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../integrating-with-alz-overview/" class="md-tabs__link">
          
  
  
    
  
  Azure Landing Zones

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../policy-definitions/" class="md-tabs__link">
          
  
  
    
  
  Define Policy Resources

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../ci-cd-overview/" class="md-tabs__link">
          
  
  
    
  
  CI/CD Integration

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../operational-scripts/" class="md-tabs__link">
          
  
  
    
  
  Operational Scripts

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../guidance-remediation/" class="md-tabs__link">
          
  
  
    
  
  Operator Guidance

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Enterprise Policy As Code (EPAC)" class="md-nav__button md-logo" aria-label="Enterprise Policy As Code (EPAC)" data-md-component="logo">
      
  <img src="../Images/10316-icon-service-Policy.svg" alt="logo">

    </a>
    Enterprise Policy As Code (EPAC)
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Azure/enterprise-azure-policy-as-code" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../start-implementing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview and Prerequisites
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../start-hydration-kit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hydration Kit
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../manual-configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Manual Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../start-extracting-policy-resources/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Extracting Policy Resources
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../start-forking-github-repo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Forking GitHub Repo
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../advanced-configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Advanced Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../start-changes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upcoming Changes in v11.0.0
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Settings and Desired State
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Settings and Desired State
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../settings-global-setting-file/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Global Settings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../settings-desired-state/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Desired State
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../settings-dfc-assignments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DfC Assignments
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Azure Landing Zones
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Azure Landing Zones
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../integrating-with-alz-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ALZ Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    ALZ Policy Integration (New)
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    ALZ Policy Integration (New)
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pre-requisites" class="md-nav__link">
    <span class="md-ellipsis">
      Pre-requisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-new-azure-landing-zone-library-sync-process" class="md-nav__link">
    <span class="md-ellipsis">
      Using the new Azure Landing Zone Library sync process
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using the new Azure Landing Zone Library sync process">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-a-policy-default-structure-file" class="md-nav__link">
    <span class="md-ellipsis">
      Create a policy default structure file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sync-with-alz-policy-repo" class="md-nav__link">
    <span class="md-ellipsis">
      Sync with ALZ Policy Repo
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alz" class="md-nav__link">
    <span class="md-ellipsis">
      ALZ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#amba-alz" class="md-nav__link">
    <span class="md-ellipsis">
      AMBA (ALZ)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slz" class="md-nav__link">
    <span class="md-ellipsis">
      SLZ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-scenarios" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Scenarios
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Scenarios">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#maintaining-multiple-alzamba-environments" class="md-nav__link">
    <span class="md-ellipsis">
      Maintaining multiple ALZ/AMBA environments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disabling-changing-specific-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Disabling / Changing specific parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploying-workload-specific-compliance-guardrails" class="md-nav__link">
    <span class="md-ellipsis">
      Deploying Workload Specific Compliance Guardrails
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-a-custom-library-for-custom-management-group-structures" class="md-nav__link">
    <span class="md-ellipsis">
      Using a custom library for custom management group structures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#migrating-from-the-legacy-sync-process-to-the-new-sync-process" class="md-nav__link">
    <span class="md-ellipsis">
      Migrating from the legacy sync process to the new sync process
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloud-adoption-framework-aligned" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud Adoption Framework Aligned
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloud-adoption-framework-unaligned" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud Adoption Framework Unaligned
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-epac-to-manage-alz-policies-in-place-of-terraform" class="md-nav__link">
    <span class="md-ellipsis">
      Using EPAC to manage ALZ policies in place of Terraform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../integrating-with-alz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ALZ Policy Integration (Legacy)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Define Policy Resources
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Define Policy Resources
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../policy-definitions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Policy Definitions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../policy-set-definitions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Policy Set Definitions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../policy-assignments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Policy Assignment Files
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../policy-assignments-csv-parameters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CSV Assignment Parameters
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../policy-exemptions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Policy Exemptions
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    CI/CD Integration
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            CI/CD Integration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ci-cd-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CI/CD Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ci-cd-app-registrations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    App Registrations Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ci-cd-branching-flows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Branching Flows
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ci-cd-ado-pipelines/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Azure DevOps Pipelines
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ci-cd-github-actions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GitHub Actions
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Operational Scripts
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Operational Scripts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../operational-scripts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Scripts Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../operational-scripts-documenting-policy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Documenting Policy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../operational-scripts-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Operator Guidance
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Operator Guidance
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guidance-remediation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Remediation Enforcement
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guidance-scope-exclusions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exclusion Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guidance-exemptions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exemption Updates
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guidance-lighthouse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lighhouse Subscription Management
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pre-requisites" class="md-nav__link">
    <span class="md-ellipsis">
      Pre-requisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-new-azure-landing-zone-library-sync-process" class="md-nav__link">
    <span class="md-ellipsis">
      Using the new Azure Landing Zone Library sync process
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using the new Azure Landing Zone Library sync process">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-a-policy-default-structure-file" class="md-nav__link">
    <span class="md-ellipsis">
      Create a policy default structure file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sync-with-alz-policy-repo" class="md-nav__link">
    <span class="md-ellipsis">
      Sync with ALZ Policy Repo
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alz" class="md-nav__link">
    <span class="md-ellipsis">
      ALZ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#amba-alz" class="md-nav__link">
    <span class="md-ellipsis">
      AMBA (ALZ)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slz" class="md-nav__link">
    <span class="md-ellipsis">
      SLZ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-scenarios" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Scenarios
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Scenarios">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#maintaining-multiple-alzamba-environments" class="md-nav__link">
    <span class="md-ellipsis">
      Maintaining multiple ALZ/AMBA environments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disabling-changing-specific-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Disabling / Changing specific parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploying-workload-specific-compliance-guardrails" class="md-nav__link">
    <span class="md-ellipsis">
      Deploying Workload Specific Compliance Guardrails
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-a-custom-library-for-custom-management-group-structures" class="md-nav__link">
    <span class="md-ellipsis">
      Using a custom library for custom management group structures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#migrating-from-the-legacy-sync-process-to-the-new-sync-process" class="md-nav__link">
    <span class="md-ellipsis">
      Migrating from the legacy sync process to the new sync process
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloud-adoption-framework-aligned" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud Adoption Framework Aligned
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloud-adoption-framework-unaligned" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud Adoption Framework Unaligned
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-epac-to-manage-alz-policies-in-place-of-terraform" class="md-nav__link">
    <span class="md-ellipsis">
      Using EPAC to manage ALZ policies in place of Terraform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="integrating-epac-with-the-azure-landing-zones-library-new">Integrating EPAC with the Azure Landing Zones Library (New)</h1>
<h2 id="pre-requisites">Pre-requisites</h2>
<p>To use the ALZ policies in an environment successfully there are some Azure Resources that need to be created. This is normally completed by using one of the ALZ accelerators to deploy the environment however if you have written your own code or modified the default deployment ensure you have the following resources in place to support the ALZ policies.</p>
<ul>
<li>Log Analytics workspace</li>
<li>DCR rules to support monitoring - <a href="https://github.com/Azure/Enterprise-Scale/tree/main/eslzArm/resourceGroupTemplates">data collection rule templates</a></li>
<li>User Assigned Managed Identity to support Azure Monitor Agent - <a href="https://github.com/Azure/Enterprise-Scale/blob/main/eslzArm/resourceGroupTemplates/userAssignedIdentity.json">sample template</a></li>
</ul>
<h2 id="using-the-new-azure-landing-zone-library-sync-process">Using the new Azure Landing Zone Library sync process</h2>
<h3 id="create-a-policy-default-structure-file">Create a policy default structure file</h3>
<p>This file contains information that drives the sync process. The file includes management group IDs, default enforcement mode, and parameter values. <strong>It must be generated at least once before executing the sync process.</strong></p>
<ol>
<li>Ensure that the EPAC module is up to date - required minimum version to use these features is 10.9.0.</li>
<li>Use to code to clone the library repository and create the default file. There are examples below on how to run this command - you will only need to run one of these depending on your requirements.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="c"># Create a Pac Environment default file for ALZ policies using the latest release of the ALZ Library release</span>
<span class="nb">New-ALZPolicyDefaultStructure</span> <span class="n">-DefinitionsRootFolder</span> <span class="p">.\</span><span class="n">Definitions</span> <span class="n">-Type</span> <span class="n">ALZ</span> <span class="n">-PacEnvironmentSelector</span> <span class="s2">&quot;epac-dev&quot;</span>

<span class="c"># Create a default file for ALZ policies specifying a tagged release of the ALZ Library </span>
<span class="nb">New-ALZPolicyDefaultStructure</span> <span class="n">-DefinitionsRootFolder</span> <span class="p">.\</span><span class="n">Definitions</span> <span class="n">-Type</span> <span class="n">ALZ</span> <span class="n">-Tag</span> <span class="s2">&quot;platform/alz/2025.02.0&quot;</span>

<span class="c"># Create a default file for ALZ policies by providing a path to a cloned/modified library </span>
<span class="nb">New-ALZPolicyDefaultStructure</span> <span class="n">-DefinitionsRootFolder</span> <span class="p">.\</span><span class="n">Definitions</span> <span class="n">-Type</span> <span class="n">ALZ</span> <span class="n">-LibraryPath</span> <span class="p">&lt;&lt;</span><span class="n">path</span> <span class="n">to</span> <span class="n">library</span><span class="p">&gt;&gt;</span>

<span class="c"># Create a default file for AMBA policies using the latest release of the ALZ Library</span>
<span class="nb">New-ALZPolicyDefaultStructure</span> <span class="n">-DefinitionsRootFolder</span> <span class="p">.\</span><span class="n">Definitions</span> <span class="n">-Type</span> <span class="n">AMBA</span>
</code></pre></div>
<ol>
<li>The file generated contains a representation of a management group structure, enforcement mode settings and required default parameter values. Update these values to match your environment.</li>
</ol>
<p>An example of where to update a parameter</p>
<div class="highlight"><pre><span></span><code><span class="nt">&quot;ama_vm_insights_data_collection_rule_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;policy_assignment_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;Deploy-VM-Monitoring&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;Deploy-VMSS-Monitoring&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;Deploy-vmHybr-Monitoring&quot;</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;The data collection rule id that should be used for the VM Insights deployment.&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;parameter_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dcrResourceId&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span><span class="c1">// Update the value here as required by the description</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>
<p>An example of where to update a management group ID</p>
<div class="highlight"><pre><span></span><code><span class="nt">&quot;management&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;management_group_function&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Management&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/providers/Microsoft.Management/managementGroups/management&quot;</span><span class="w"> </span><span class="c1">//replace with your management group ID</span>
<span class="w">    </span><span class="p">},</span>
</code></pre></div>
<p>Modify the default enforcement mode</p>
<div class="highlight"><pre><span></span><code><span class="nt">&quot;enforcementMode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Default&quot;</span><span class="w"> </span><span class="c1">// Can be Default or DoNotEnforce</span>
</code></pre></div>
<h3 id="sync-with-alz-policy-repo">Sync with ALZ Policy Repo</h3>
<p>The next command will generate policy assignments based on the values in this file so ensure they are correct for your environment.</p>
<ol>
<li>Use to code to sync the policy files and update scopes and parameters based on the information in the previously created file. There are examples below on how to run this command - you will only need to run one of these depending on your requirements. The files will be copied into their own folder to separate them from any definitions already in the repository.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="c"># Sync the ALZ policies and assign to the &quot;epac-dev&quot; PAC environment.</span>
<span class="nb">Sync-ALZPolicyFromLibrary</span> <span class="n">-DefinitionsRootFolder</span> <span class="p">.\</span><span class="n">Definitions</span> <span class="n">-Type</span> <span class="n">ALZ</span> <span class="n">-PacEnvironmentSelector</span> <span class="s2">&quot;epac-dev&quot;</span>

<span class="c"># Sync the ALZ policies and assign to the &quot;epac-dev&quot; PAC environment. Specify a released version of the ALZ library</span>
<span class="nb">Sync-ALZPolicyFromLibrary</span> <span class="n">-DefinitionsRootFolder</span> <span class="p">.\</span><span class="n">Definitions</span> <span class="n">-Type</span> <span class="n">ALZ</span> <span class="n">-PacEnvironmentSelector</span> <span class="s2">&quot;epac-dev&quot;</span> <span class="n">-Tag</span> <span class="s2">&quot;platform/alz/2025.02.0&quot;</span>

<span class="c"># Sync the ALZ policies from a cloned/modified library</span>
<span class="nb">Sync-ALZPolicyFromLibrary</span> <span class="n">-DefinitionsRootFolder</span> <span class="p">.\</span><span class="n">Definitions</span> <span class="n">-Type</span> <span class="n">ALZ</span> <span class="n">-PacEnvironmentSelector</span> <span class="s2">&quot;epac-dev&quot;</span> <span class="n">-LibraryPath</span> <span class="p">&lt;&lt;</span><span class="n">path</span> <span class="n">to</span> <span class="n">library</span><span class="p">&gt;&gt;</span>

<span class="c"># Sync the AMBA policies and assign to the &quot;epac-dev&quot; PAC environment.</span>
<span class="nb">Sync-ALZPolicyFromLibrary</span> <span class="n">-DefinitionsRootFolder</span> <span class="p">.\</span><span class="n">Definitions</span> <span class="n">-Type</span> <span class="n">AMBA</span> <span class="n">-PacEnvironmentSelector</span> <span class="s2">&quot;epac-dev&quot;</span>

<span class="c"># Sync the AMBA policies and assign to the &quot;epac-dev&quot; PAC environment. Specify a released version of the ALZ library</span>
<span class="nb">Sync-ALZPolicyFromLibrary</span> <span class="n">-DefinitionsRootFolder</span> <span class="p">.\</span><span class="n">Definitions</span> <span class="n">-Type</span> <span class="n">AMBA</span> <span class="n">-PacEnvironmentSelector</span> <span class="s2">&quot;epac-dev&quot;</span> <span class="n">-Tag</span> <span class="s2">&quot;platform/amba/2025.06.0&quot;</span>
</code></pre></div>
<p>Carefully review the generated policy assignments and ensure all parameter and scope information is correct.</p>
<ol>
<li>When complete run <code>Build-DeploymentPlans</code> to ensure the correct changes are made. During the first sync for either a new or existing environment there will be many changes due to updating of the existing policies.</li>
</ol>
<h2 id="examples">Examples</h2>
<h3 id="alz">ALZ</h3>
<div class="highlight"><pre><span></span><code><span class="c"># Create a Pac Environment default file for ALZ policies using the latest release of the ALZ Library </span>
<span class="nb">New-ALZPolicyDefaultStructure</span> <span class="n">-DefinitionsRootFolder</span> <span class="p">.\</span><span class="n">Definitions</span> <span class="n">-Type</span> <span class="n">ALZ</span> <span class="n">-PacEnvironmentSelector</span> <span class="s2">&quot;epac-dev&quot;</span>

<span class="c"># Sync the ALZ policies and assign to the &quot;epac-dev&quot; PAC environment.</span>
<span class="nb">Sync-ALZPolicyFromLibrary</span> <span class="n">-DefinitionsRootFolder</span> <span class="p">.\</span><span class="n">Definitions</span> <span class="n">-Type</span> <span class="n">ALZ</span> <span class="n">-PacEnvironmentSelector</span> <span class="s2">&quot;epac-dev&quot;</span>
</code></pre></div>
<h3 id="amba-alz">AMBA (ALZ)</h3>
<p>For users interested in deploying the <a href="https://azure.github.io/azure-monitor-baseline-alerts/welcome/">Azure Monitor Baseline Alerts</a> project with EPAC use the commands below.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is recommended to review breaking changes on the <a href="https://azure.github.io/azure-monitor-baseline-alerts/patterns/alz/HowTo/UpdateToNewReleases/">AMBA Releases</a> page to avoid unexpected failed policy deployments. In most cases, it's an update of a parameter type (i.e. String -&gt; Array).</p>
</div>
<div class="highlight"><pre><span></span><code><span class="c"># Create a Pac Environment default file for AMBA policies using the latest release of the ALZ Library </span>
<span class="nb">New-ALZPolicyDefaultStructure</span> <span class="n">-DefinitionsRootFolder</span> <span class="p">.\</span><span class="n">Definitions</span> <span class="n">-Type</span> <span class="n">AMBA</span> <span class="n">-PacEnvironmentSelector</span> <span class="s2">&quot;epac-dev&quot;</span>

<span class="c"># Sync the AMBA policies and assign to the &quot;epac-dev&quot; PAC environment.</span>
<span class="nb">Sync-ALZPolicyFromLibrary</span> <span class="n">-DefinitionsRootFolder</span> <span class="p">.\</span><span class="n">Definitions</span> <span class="n">-Type</span> <span class="n">AMBA</span> <span class="n">-PacEnvironmentSelector</span> <span class="s2">&quot;epac-dev&quot;</span>
</code></pre></div>
<h3 id="slz">SLZ</h3>
<p>For users interested in deploying the <a href="https://github.com/Azure/sovereign-landing-zone/blob/main/docs/scenarios/Sovereignty-Baseline-Policy-Initiatives.md">Sovereignty Policy Baseline</a> project with EPAC use the commands below.</p>
<div class="highlight"><pre><span></span><code><span class="c"># Create a Pac Environment default file for SLZ policies using the latest release of the ALZ Library </span>
<span class="nb">New-ALZPolicyDefaultStructure</span> <span class="n">-DefinitionsRootFolder</span> <span class="p">.\</span><span class="n">Definitions</span> <span class="n">-Type</span> <span class="n">SLZ</span> <span class="n">-PacEnvironmentSelector</span> <span class="s2">&quot;epac-dev&quot;</span>

<span class="c"># Sync the SLZ policies and assign to the &quot;epac-dev&quot; PAC environment.</span>
<span class="nb">Sync-ALZPolicyFromLibrary</span> <span class="n">-DefinitionsRootFolder</span> <span class="p">.\</span><span class="n">Definitions</span> <span class="n">-Type</span> <span class="n">SLZ</span> <span class="n">-PacEnvironmentSelector</span> <span class="s2">&quot;epac-dev&quot;</span>
</code></pre></div>
<h2 id="advanced-scenarios">Advanced Scenarios</h2>
<p>Using the format of the Azure Landing Zones repository it is possible to enable some advanced scenarios. Many of these are based around customization to the recommended ALZ management group structure. It is recommended to maintain your own fork of the ALZ Library in some of these cases.</p>
<h3 id="maintaining-multiple-alzamba-environments">Maintaining multiple ALZ/AMBA environments</h3>
<p>If you need to have separate parameter values or different management group names for different PAC environments you can follow steps below.</p>
<ol>
<li>Generate a policy structure file using <code>New-ALZPolicyDefaultStructure</code> and specify the <code>-PacEnvironmentSelector</code> parameter.</li>
</ol>
<p>This generates a standard file structure however the file's name will now include the Pac Selector given. This default structure will now be used every time you run the "Sync-ALZPolicyFromLibrary" command with the matching PacEnvironmentSelector.</p>
<p>For example: -</p>
<div class="highlight"><pre><span></span><code>alz.policy_default_structure.&lt;PAC SELECTOR&gt;.jsonc
</code></pre></div>
<ol>
<li>When syncing policies run the <code>Sync-ALZPolicyFromLibrary</code> once for each PAC Environment. A folder specific for that Pac Selector will now be placed within the ALZ Type.</li>
</ol>
<h3 id="disabling-changing-specific-parameters">Disabling / Changing specific parameters</h3>
<p>If you need to disable a single policy parameter, such as the 'effect' for a specific policy within an assignment, add that parameter to your default file structure to ensure it is not overwritten when running the <strong>Sync-ALZPolicyFromLibrary</strong> command.</p>
<p>An example of disabling the <strong>"Configure Microsoft Defender for Key Vault plan"</strong> in the <strong>"Deploy-MDFC-Config-H224"</strong> Policy Assignment.</p>
<div class="highlight"><pre><span></span><code><span class="nt">&quot;enableAscForKeyVault_effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;policy_assignment_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;Deploy-MDFC-Config-H224&quot;</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Enable or disable the execution of the Key Vault DFC policy.&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;parameter_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;enableAscForKeyVault&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Disabled&quot;</span><span class="w"> </span><span class="c1">// Update the value here as required by the description</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>
<h3 id="deploying-workload-specific-compliance-guardrails">Deploying Workload Specific Compliance Guardrails</h3>
<p>To deploy the workload specific compliance guardrails for Azure Landing Zones the default policy structure file should contain an <code>enforceGuardrails</code> key. If it doesn't you can rerun the <code>New-ALZPolicyDefaultStructure</code> command to generate a file containing this entry.</p>
<p>By default ALZ specifies deploying all the guardrail policies to the <code>platform</code> and <code>landingzones</code> management group and when the <code>Sync-ALZPolicyFromLibrary</code> with the <code>-CreateGuardrailAssignments</code> parameter command runs it will generate assignments which are scoped to these management groups.</p>
<p>To modify this behavior you can update/modify the scopes in the <code>deployment.scopes</code> entry - or if you want to deploy different guardrails to different scopes simply create another entry within the <code>enforceGuardrails.deployment</code> array similar to below.</p>
<div class="highlight"><pre><span></span><code>&quot;enforceGuardrails&quot;: {
    &quot;deployments&quot;: [
      {
        &quot;scope&quot;: [
          &quot;/providers/Microsoft.Management/managementGroups/landingzones&quot;
        ],
        &quot;policy_set_names&quot;: [
          &quot;Enforce-Guardrails-APIM&quot;,
          &quot;Enforce-Guardrails-AppServices&quot;,
          &quot;Enforce-Guardrails-Automation&quot;
        ]
      },
      {
        &quot;scope&quot;: [
          &quot;/providers/Microsoft.Management/managementGroups/platform&quot;
        ],
        &quot;policy_set_names&quot;: [
          &quot;Enforce-Guardrails-APIM&quot;,
          &quot;Enforce-Guardrails-AppServices&quot;,
          &quot;Enforce-Guardrails-Automation&quot;
        ]
      }
    ]
}
</code></pre></div>
<p>Example to generate assignments with guardrails assignments included.</p>
<div class="highlight"><pre><span></span><code># Sync the ALZ policies and assign to the &quot;epac-dev&quot; PAC environment.
Sync-ALZPolicyFromLibrary -DefinitionsRootFolder .\Definitions -Type ALZ -PacEnvironmentSelector &quot;epac-dev&quot; -CreateGuardrailAssignments
</code></pre></div>
<h3 id="using-a-custom-library-for-custom-management-group-structures">Using a custom library for custom management group structures</h3>
<p>Azure environments may not always be aligned with the default management group structure suggested by Azure Landing Zones. In this case it is required to maintain your own version of the Azure Landing Zone library repository and make changes in there to the default structure. This will increase the overall complexity in maintaining synchronization as you will have to manage any updates to the forked repository.</p>
<p>In the example below it follows a typical customer customization where instead of having a corp/online management group structure it has been elected to use a non-production/production management group structure.</p>
<p>The updated management group structure would follow similar to below:-</p>
<div class="highlight"><pre><span></span><code>--Azure Landing Zones MG
 |_Non-Production MG
 |_ Production MG
</code></pre></div>
<ol>
<li>Create a fork of the <a href="https://github.com/Azure/Azure-Landing-Zones-Library">Azure Landing Zone Library</a> and clone it locally. When later running the <code>New-ALZPolicyDefaultStructure</code> and <code>Sync-ALZPolicyFromLibrary</code> commands you will need to ensure the <code>-LibraryPath</code> parameter points to this cloned repo.</li>
<li>For ALZ there are two files which need to be updated - firstly we need to add the new management group archetypes into the <code>\platform\alz\architecture_definitions\alz.alz_architecture_definition.json</code> file. In this example I will remove the <code>corp</code> and <code>online</code> entries from this file and replace them with a non-production and production key as below:-</li>
</ol>
<div class="highlight"><pre><span></span><code>{
      &quot;archetypes&quot;: [
        &quot;non-production&quot;
      ],
      &quot;display_name&quot;: &quot;Non-Production&quot;,
      &quot;exists&quot;: false,
      &quot;id&quot;: &quot;non-production&quot;,
      &quot;parent_id&quot;: &quot;landingzones&quot;
    },
    {
      &quot;archetypes&quot;: [
        &quot;production&quot;
      ],
      &quot;display_name&quot;: &quot;Production&quot;,
      &quot;exists&quot;: false,
      &quot;id&quot;: &quot;production&quot;,
      &quot;parent_id&quot;: &quot;landingzones&quot;
    }
</code></pre></div>
<ol>
<li>Now that the new archetypes have been added there needs to be archetype definition files created - which tie together which assignments are associated to these archetypes. For this example we will apply the same assignments as what would have been applied to the <code>corp</code> management group to the new management groups.</li>
<li>In the forked repository in the folder <code>\platform\alz\archetype_definitions</code> we can copy the <code>corp.alz_archetype_definition.json</code> file twice and rename it to <code>non-production.alz_archetype_definition.json</code> and <code>production.alz_archetype_definition.json</code>. For each file update the <code>name</code> key in the file to match e.g.</li>
</ol>
<div class="highlight"><pre><span></span><code>{
  &quot;$schema&quot;: &quot;https://raw.githubusercontent.com/Azure/Azure-Landing-Zones-Library/main/schemas/archetype_definition.json&quot;,
  &quot;name&quot;: &quot;production&quot;,
  &quot;policy_assignments&quot;: [
    &quot;Audit-PeDnsZones&quot;,
    &quot;Deny-HybridNetworking&quot;,
    &quot;Deny-Public-Endpoints&quot;,
    &quot;Deny-Public-IP-On-NIC&quot;,
    &quot;Deploy-Private-DNS-Zones&quot;
  ],
  &quot;policy_definitions&quot;: [],
  &quot;policy_set_definitions&quot;: [],
  &quot;role_definitions&quot;: []
}
</code></pre></div>
<ol>
<li>Since the <code>corp</code> and <code>online</code> archetypes no longer exist I can rename the archetype files for these with a <code>.bak</code> extension so the sync script does not include them.</li>
<li>The new structure file can now be generated - for example:-</li>
</ol>
<div class="highlight"><pre><span></span><code>New-ALZPolicyDefaultStructure -DefinitionsRootFolder .\Definitions\ -Type ALZ -LibraryPath ..\alz-library-fork\ -PacEnvironmentSelector epac-dev
</code></pre></div>
<p>This file will contain the new management groups in the structure file as below:-</p>
<div class="highlight"><pre><span></span><code>&quot;non-production&quot;: {
  &quot;value&quot;: &quot;/providers/Microsoft.Management/managementGroups/non-production&quot;,
  &quot;management_group_function&quot;: &quot;Non-Production&quot;
},
&quot;production&quot;: {
  &quot;value&quot;: &quot;/providers/Microsoft.Management/managementGroups/production&quot;,
  &quot;management_group_function&quot;: &quot;Production&quot;
}
</code></pre></div>
<ol>
<li>Run the sync command to import the policies and generate the assignments - for example:-</li>
</ol>
<div class="highlight"><pre><span></span><code>Sync-ALZPolicyFromLibrary.ps1 -DefinitionsRootFolder .\Definitions\ -Type ALZ -LibraryPath ..\alz-library-fork\ -PacEnvironmentSelector epac-dev
</code></pre></div>
<ol>
<li>There are now two new folders in the <code>policyAssignments\ALZ</code> folder as below, and looking at the assigned scope for the assignments we can see they are going to be assigned to the correct management group.</li>
</ol>
<p><img alt="Assignment File Overview Diagram" src="../Images/new-management-groups.png" /></p>
<div class="highlight"><pre><span></span><code>&quot;scope&quot;: {
    &quot;epac-dev&quot;: [
      &quot;/providers/Microsoft.Management/managementGroups/non-production&quot;
    ]
  }
</code></pre></div>
<ol>
<li>When maintaining parity with updates from the ALZ team including policy changes and new assignments it will be necessary to sync your forked repo and carefully check the incoming changes.</li>
</ol>
<h3 id="migrating-from-the-legacy-sync-process-to-the-new-sync-process">Migrating from the legacy sync process to the new sync process</h3>
<p>The process to migrate from the legacy sync process to the new process mainly involves changes to how the assignment files are generated and maintained. If the environment structure is well-aligned to the Cloud Adoption Framework the process will be fairly seamless. For environments which aren't aligned it will present a little bit more of a challenge however the initial complexity is balanced by less maintenance in the future when synchronizing.</p>
<h3 id="cloud-adoption-framework-aligned"><em>Cloud Adoption Framework Aligned</em></h3>
<p>Use the process <a href="./#using-the-new-azure-landing-zone-library-sync-process">documented here</a>.</p>
<p>Ensure that the management groups and the parameter values are updated in the newly generated structure file. When synchronizing and running the build plan changes should be fairly minimal as all the assignments already exist - but any discrepancies should be examined as to why changes are being made.</p>
<h3 id="cloud-adoption-framework-unaligned"><em>Cloud Adoption Framework Unaligned</em></h3>
<p>Because the environment is not aligned to CAF - the sync process using the legacy method will already require a number of changes to the default assignment files. In this case it is best to maintain a <a href="./#using-a-custom-library-for-custom-management-group-structures">custom library</a>.</p>
<p>Carefully add the new archetypes to the cloned library - ensuring that all assignments are included.</p>
<p>Again the sync process should be fairly simple as all the assignments already exist - however there will be more assignment files to manage. Setting up the custom library properly will ensure a seamless transition.</p>
<h3 id="using-epac-to-manage-alz-policies-in-place-of-terraform">Using EPAC to manage ALZ policies in place of Terraform</h3>
<p>If you are using Terraform to manage ALZ policies but are planning on integrating EPAC - you must stop Terraform from managing the policies.</p>
<p>Depending on the method of deployment for your Terraform based ALZ you can use the links below to find files which can override the default archetypes containing the policy definitions and assignments. Use these in your Terraform repo to remove its ability to manage policy.</p>
<ul>
<li>Azure Verified Module - avm-ptn-alz - <a href="https://github.com/anwather/epac-removetf-avm">https://github.com/anwather/epac-removetf-avm</a></li>
<li>Legacy CAF module - terraform-azurerm-caf-enterprise-scale - <a href="https://github.com/anwather/epac-removetf">https://github.com/anwather/epac-removetf</a></li>
</ul>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.indexes", {"navigation.sections": {"level": 1}}, "navigation.tabs", "navigation.tabs.sticky", "content.code.annotate", "content.tabs.link", "content.code.copy"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>